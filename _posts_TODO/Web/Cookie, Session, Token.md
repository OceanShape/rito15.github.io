
# Stateless Server
---
- 쿠키&세션 또는 토큰은 Stateless Server의 핵심 요소 중 하나라고 할 수 있다.
- Stateless는 이전 요청이 현재 요청에 영향을 주지 않는 것을 의미한다.
- 즉, 서버에 트랜잭션 처리 상태를 저장할 별도의 스토리지를 두지 않는 것을 뜻하며
- 결국 모든 요청이 매 순간마다 독립적으로 처리된다.
- 그래서 클라이언트가 Stateless Server에 요청할 때는, 요청마다 자기 정보를 보내야 한다.



# Cookie
---
- 사용자의 인증 정보(세션 ID)를 저장하는 객체
- 쿠키는 사용자 인증 정보 뿐만 아니라 브라우저 또는 운영체제 등이 포함하는 다양한 정보를 담을 수 있다.

- 쿠키 내에는 서버가 발급한 세션ID가 존재한다.
- 실제로 인증에 사용되는 것은 이 세션ID다.

- 쿠키는 사용자의 브라우저 및 로컬 환경 내에 저장될 수 있다.
- 쿠키는 동일 플랫폼 내에서만 사용될 수 있다.
- 쿠키는 유효 기간이 존재한다.

- 브라우저는 서버에 인증이 필요한 요청을 할 때 쿠키를 함께 보낸다.
- 쿠키를 탈취하면 해당 사용자의 인증을 그대로 사용할 수 있다.

- 쿠키는 브라우저에만 존재하며 안드로이드, iOS 등의 네이티브 앱에는 존재하지 않는다.



# Session
---
- 세션은 서버에 저장되는 사용자 인증 정보를 의미한다.
- 세션 내에는 쿠키와 일치하는 세션 ID를 저장한다.

- 서버가 클라이언트로부터 쿠키를 전달받으면 세션 저장소 내의 세션을 확인하여,
  세션 ID의 일치 여부를 검증한다.

- 서버는 쿠키를 받아 세션과의 정보 일치 여부를 검증하기 위해 항상 세션 DB에 접근해야 한다.
- 사용자가 늘어남에 따라, 세션 DB의 규모도 덩달아 커진다.



# Token
---
- 사용자 정보를 담고 있는 길고 암호화된 문자열
- 쿠키보다 길다.
- 서버 내에 저장소가 따로 존재하지 않는다.
- 인증은 토큰만으로 이루어진다.
- 한 번 만들어지면 서버에서 제어할 방도가 없으므로, 만료 기한을 토큰에 명시해야 한다.

- Header + Payload + Signature 형태로 이루어진다.
- Header : 토큰 타입(JWT 등), 해싱 알고리즘
- Payload : 사용자 정보, 만료 기한, 필요한 내용들
- Signature : Header, Payload의 무결성 및 변조 방지를 위한 암호화 서명

- 대표적인 토큰 형식으로 JWT(JSON Web Token)이 있다.
- JWT는 JSON 형식이며, 그 자체로는 암호화되지 않는다.
- JWT에서 암호화되는 부분은 서명이다.
- 따라서 JWT 내에 사용자 정보를 저장해서는 안된다.



# Cookie&Session, Token의 차이점
---
- 쿠키는 플랫폼마다 형태가 다를 수 있으므로 범용성이 떨어진다.
- 세션은 서버에 저장되어야 하므로 별도의 스토리지가 필요하다.
- 서버가 스케일-업 될 경우, 세션 검증을 위한 전용 서버가 따로 필요하다.
- 쿠키&세션 방식을 사용하면 서버는 실시간으로 사용자의 로그인 정보, 최대 로그인 허용 가능 기기 개수 등을 원하는대로 제어할 수 있다.
- 따라서 서버가 사용자를 강제로 로그아웃시킬 수도 있다.

- 토큰은 플랫폼마다 형태가 다르지 않다.
- 토큰은 서버에 저장될 필요가 없다.
- 토큰은 한번 생성되면 서버에서 제어할 방법이 없다.
- 토큰은 토큰 정보 내에 만료 시간을 넣어줄 필요가 있다.
- 토큰은 토큰 기반의 다른 인증 시스템에 접근할 수 있다.
  Google, MS, Facebook 등의 로그인 프로필을 다른 써드파티 웹사이트에
  토큰을 통해 간편히 전달하여 제휴 가입 및 로그인 정보 유지를 편하게 할 수 있다.
  
- 토큰을 사용할 경우 서버로 인한 사용자 강제 로그아웃 등의 기능을 사용할 수 없다.
- 토큰 사용 시, 사용자의 자발적 로그아웃은 그냥 사용자가 스스로 토큰을 지우는 것이다.



# Cookie, Session을 이용한 로그인 및 인증 과정
---
- 사용자가 ID, PW를 입력하여 로그인한다.
- 사용자의 브라우저에서는 Post 요청을 통해 ID, PW를 서버에 전달한다.

- 서버는 사용자의 정보를 이용해 세션 ID를 발급하고, 이를 서버 내의 세션 저장소에 저장한다.
- 세션 ID를 쿠키에 담아 사용자에게 전달한다.
- 사용자는 쿠키를 브라우저 및 로컬 스토리지에 저장한다.

- 이후 인증이 필요할 때마다 사용자는 쿠키를 서버에 보낸다.
- 서버는 쿠키를 확인하여 유효한 세션 ID가 존재하면 통과시켜준다.



# Token을 이용한 로그인 과정
---
- 사용자가 ID, PW를 입력하여 로그인한다.
- 사용자의 브라우저에서는 Post 요청을 통해 ID, PW를 서버에 전달한다.

- 서버는 사용자의 로그인 여부, 아이디 등 정보를 담고 위조가 불가능하도록 서명을 추가하고,
  암호화하여 토큰(문자열)을 생성하고 사용자에게 전달한다.
- 사용자는 브라우저 및 로컬 스토리지에 토큰을 저장한다.

- 이후 인증이 필요할 때마다 사용자는 토큰을 서버에 보낸다.
- 서버는 토큰의 서명을 확인하고 유효성을 검증하여 통과 여부를 걸정한다.