TITLE : 유니티 - 트랜스폼의 벡터 공간 변환 메소드 정리


# 벡터의 기본 개념
---

<details>
<summary markdown="span">
초심자용 설명
</summary>

벡터는 두 가지로 해석할 수 있다.

1. 위치 벡터
2. 방향 벡터

아핀 공간의 벡터, 벡터 공간의 벡터라고도 각각 표현하는데 이건 초심자에게는 별세계 이야기일 수 있으니 넘어간다.

<br>

위치 벡터로 해석할 때는 '공간 상의 위치 좌표',

방향 벡터로 해석할 때는 '원점으로부터 해당 위치를 가리키는 벡터'

이렇게 해석할 수 있는데,

그림으로는 각각 점과 화살표로 표현된다.

![image](https://user-images.githubusercontent.com/42164422/141428315-f5031c16-b0a6-413e-bec8-bd1794358cb1.png)

동일한 값의 벡터가 위치 벡터, 방향 벡터일 때 전혀 달라지는가?

그렇지 않다.

그냥 용도에 따른 해석의 차이일 뿐이다.

<br>

예를 들면 "오브젝트가 2D 공간 상에서 `(2, 2)` 위치에 있다"

이렇게 표현할 때는 위치 벡터로 해석한 것이고,

"2D 공간의 원점에서부터 오브젝트까지 향하는 벡터는 `(2, 2)`이다"

이 때는 방향 벡터로 해석한 것이다.

<br>

정말로 해석하기 나름이고, 벡터를 자주 접하다보면 상황에 따라 해석하는 방법을 익히게 된다.

예시로, 대표적인 벡터 연산인 내적과 외적은 방향으로서의 성질을 갖는 벡터에 대한 연산이다.

</details>

<br>


# 벡터 공간 변환의 개념
---

<details>
<summary markdown="span">
역시 초심자용
</summary>

아주 간단하게 공간 변환의 기본 개념에 대해서만 짚는다.

<br>

## **위치 변환**

![image](https://user-images.githubusercontent.com/42164422/141429784-8410f68d-5437-42e8-abf3-72229b3073a5.png)

위치 변환은 아주 쉽다.

기본적으로 상대 좌표의 개념이라고 보면 된다.

`B`는 `A`로부터 `(3, 2)`만큼 떨어져 있으므로 `A`를 기준으로 `B`의 상대좌표는 `(3, 2)`이다.

`A`는 `B`로부터 `(-3, -2)`만큼 떨어져 있으므로 `B`를 기준으로 `A`의 상대좌표는 `(-3, -2)`이다.

<br>

공간 변환의 정석적인 개념으로 설명해보면,

`A` 기준의 상대좌표라는 것은 `A`의 좌표가 `(0, 0)`인 공간에서의 좌표를 의미한다.

`(2, 2)`가 `(0, 0)`이 되려면 `(-2, -2)`를 더해주면 된다.

따라서 월드 공간에서의 좌표에 `(-2, -2)`를 더해주면 `A` 기준 공간의 좌표가 된다.

![image](https://user-images.githubusercontent.com/42164422/141434638-8bc457b8-7b77-4ca8-836d-179ae548e8e7.png)

<br>

마찬가지로 `B` 기준의 상대좌표는 `B`가 원점인 공간에서의 좌표를 의미한다.

![image](https://user-images.githubusercontent.com/42164422/141435093-0d692eb8-311b-4a9b-8e03-ef5b8e78f213.png)

<br>

트랜스폼의 오일러 회전값은 `(0, 0, 0)`, 스케일은 `(1, 1, 1)`이라고 할 때,

`A` 게임오브젝트의 트랜스폼에서 `B`의 위치인 `(5, 4)`에 대한

`transform.InverseTransformPoint(5, 4)`의 결과는 `(3, 2)`가 된다.

`A` 기준 공간에서 `B`의 상대 좌표를 구한 것이다.

> **NOTE** <br>
> Transform 변환 메소드는 3차원에 대해 계산하기에 <br>
> `InverseTransformPoint(5, 4, 0)`이라고 해야 하지만, <br>
> 설명을 위해 2차원의 입력값을 받을 수 있는 것처럼 가정한다.

<br>

반대로 `A` 기준 `B`의 상대 좌표인 `(3, 2)`를

`transform.TransformPoint(3, 2)`로 계산하면 `B`의 월드 좌표인 `(5, 4)`가 된다.

<br>

`TransformPoint(상대 좌표) => 월드 좌표`

`InverseTransformPoint(월드 좌표) => 상대 좌표`

이렇게 정리할 수 있다.

상대 좌표는 특정 오브젝트의 로컬 공간 기준 좌표이므로, `로컬 좌표`라고도 표현한다.

<br>


## **회전 변환**

유니티 C#에서 직접적으로 많이 사용하는 벡터의 공간 변환이 회전 변환이다.

`transform.TransformDirection()`, `transformInverseTransformDirection()`을 통해서 벡터를 회전 변환할 수 있다.

<br>

![image](https://user-images.githubusercontent.com/42164422/141432511-80a061cf-0d56-4fd2-8a99-6e78a2b4d0b2.png)

`A`는 

<br>

## **크기 변환**



</details>


<br>


# 1. 로컬-월드 변환
---

## **[1] TransformPoint()**

- `위치`, `회전`, `크기` 변환을 적용한다.

- 방향 벡터가 아니라, 위치 벡터를 월드 위치로 변환할 때 사용한다.

- 메시의 로컬 정점 좌표로부터 월드 정점 좌표를 구할 때처럼, <br>
  오브젝트에 완전히 종속적인 위치 벡터를 변환할 때 사용된다.

- C# 스크립트에서는 딱히 자주 쓰이지 않는다.

<br>


## **[2] TransformVector()**

- `회전`, `크기` 변환을 적용한다.

- 메시의 노멀 벡터처럼 오브젝트에 종속적인 방향 벡터를 월드로 변환할 때 사용된다.

- 이것도 C# 스크립트에서 딱히 쓸 일은 없어 보인다.

- 혹시나 방향 벡터를 변환할 때 `TransformDirection()`과 이 메소드를 혼동하여 쓰게 될 경우, 의도치 않은 값을 얻을 수 있으니 주의해야 한다.

<br>


## **[3] TransformDirection()**

- `회전` 변환만 적용한다.

- 로컬 공간의 방향 벡터를 트랜스폼의 월드 공간 방향 벡터로 바꿀 때 사용된다.

- `Transform`의 변환 메소드 중에서는 가장 자주 쓰이는 편이다.

<br>

- 예시 : 키보드 입력에 따른 이동 방향 벡터를 로컬 공간에서 조립하여, <br>
  캐릭터의 현재 회전에 맞게 월드 벡터로 변환한다.

```cs
float h = Input.GetAxisRaw("Horizontal");
float v = Input.GetAxisRaw("Vertical");
Vector3 moveDir = new Vector3(h, 0f, v).normalized;
Vector3 worldMoveDir = transform.TransformDirection(moveDir);
```

<br>



# 2. 월드-로컬 변환
---

## **[1] InverseTransformPoint()**

- `위치`, `회전`, `크기` 변환을 적용한다.

- 방향 벡터가 아니라, 위치 벡터를 변환할 때 사용한다.

- 메시의 월드 정점 좌표로부터 로컬 정점 좌표를 구할 때 사용된다.

- 쉐이더도 아니고, C# 스크립트에서는 정말로 쓸 일이 드문 메소드

<br>

## **[2] InverseTransformVector()**

- `회전`, `크기` 변환을 적용한다.

- 마찬가지로 C# 스크립트에서 굳이 사용할 일이 별로 없으며, 괜히 `InverseTransformDirection()`과 혼동하지 않도록 주의한다.

<br>


## **[3] InverseTransformDirection()**

- `회전` 변환만 적용한다.

- 월드 공간의 방향 벡터를 트랜스폼의 로컬 공간 방향 벡터로 바꿀 때 사용된다.

- 예시 : 내적을 통해 적이 캐릭터의 왼쪽 또는 오른쪽에 있는지 파악하기

```cs
Vector3 enemyPos  = ...;                // 적의 현재 월드 위치
Vector3 playerPos = transform.position; // 플레이어 캐릭터의 현재 월드 위치

Vector3 playerToEnemyDir = enemyPos - playerPos;
Vector3 localEnemyDir = transform.InverseTransformDirection(playerToEnemyDir);

float d = Vector3.Dot(localEnemyDir, Vector3.right);

// d >= 0 : 적은 플레이어 캐릭터의 우측에 존재
// d <  0 : 적은 플레이어 캐릭터의 좌측에 존재
```

<br>


# References
---
- <https://irfanbaysal.medium.com/differences-between-transformvector-transformpoint-and-transformdirection-2df6f3ebbe11>
- <https://docs.unity3d.com/ScriptReference/Transform.html>